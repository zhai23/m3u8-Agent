# M3U8-Agent

<div align="center">

**è½»é‡çº§ M3U8 è§†é¢‘ä¸‹è½½å™¨ - å‰åç«¯åˆ†ç¦»æ¶æ„**

[![Python](https://img.shields.io/badge/Python-3.11%20%7C%203.12%20%7C%203.13-blue.svg)](https://www.python.org/)
[![FastAPI](https://img.shields.io/badge/FastAPI-0.104+-green.svg)](https://fastapi.tiangolo.com/)
[![License](https://img.shields.io/badge/License-GPLv3-blue.svg)](LICENSE)

[åŠŸèƒ½ç‰¹æ€§](#åŠŸèƒ½ç‰¹æ€§) â€¢ [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹) â€¢ [ä½¿ç”¨è¯´æ˜](#ä½¿ç”¨è¯´æ˜) â€¢ [é…ç½®è¯´æ˜](#é…ç½®è¯´æ˜) â€¢ [å¼€å‘æ–‡æ¡£](#å¼€å‘æ–‡æ¡£)

</div>

---

## ğŸ“– é¡¹ç›®ç®€ä»‹

M3U8-Agent æ˜¯ä¸€ä¸ªåŸºäº [N_m3u8DL-RE](https://github.com/nilaoda/N_m3u8DL-RE) çš„è½»é‡çº§ M3U8 è§†é¢‘ä¸‹è½½å™¨ï¼Œé‡‡ç”¨å‰åç«¯åˆ†ç¦»æ¶æ„ï¼Œæä¾›ç®€æ´æ˜“ç”¨çš„ Web ç•Œé¢å’Œå¼ºå¤§çš„ä¸‹è½½åŠŸèƒ½ã€‚

### æ ¸å¿ƒç‰¹æ€§

- âœ¨ **çº¯é™æ€å‰ç«¯** - HTML + CSS + JavaScriptï¼Œæ— éœ€æ„å»ºå·¥å…·
- ğŸš€ **FastAPI åç«¯** - é«˜æ€§èƒ½å¼‚æ­¥ API æœåŠ¡
- ğŸ“Š **å®æ—¶è¿›åº¦** - åŸºäº SSE çš„å®æ—¶è¿›åº¦æ¨é€
- ğŸ”„ **å¤šä»»åŠ¡ç®¡ç†** - æ”¯æŒå¤šä»»åŠ¡å¹¶å‘ä¸‹è½½
- ğŸ’¾ **æ— æ•°æ®åº“** - ä½¿ç”¨ JSON æ–‡ä»¶å­˜å‚¨ï¼Œè½»é‡ç®€æ´
- ğŸ¯ **æ˜“äºéƒ¨ç½²** - å‰åç«¯åˆ†ç¦»ï¼Œçµæ´»éƒ¨ç½²

---

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### ä¸‹è½½åŠŸèƒ½
- âœ… M3U8 è§†é¢‘ä¸‹è½½
- âœ… å¤šçº¿ç¨‹å¹¶å‘ä¸‹è½½
- âœ… æ–­ç‚¹ç»­ä¼ æ”¯æŒ
- âœ… è‡ªåŠ¨é‡è¯•æœºåˆ¶
- âœ… é€Ÿåº¦é™åˆ¶
- âœ… ä»£ç†æ”¯æŒ

### ä»»åŠ¡ç®¡ç†
- âœ… åˆ›å»º/åˆ é™¤ä»»åŠ¡
- âœ… å¯åŠ¨/æš‚åœä»»åŠ¡
- âœ… å®æ—¶è¿›åº¦æ˜¾ç¤º
- âœ… ä»»åŠ¡çŠ¶æ€è¿½è¸ª
- âœ… é”™è¯¯ä¿¡æ¯è®°å½•

### ç•Œé¢ç‰¹æ€§
- âœ… ç®€æ´ç›´è§‚çš„ Web ç•Œé¢
- âœ… å®æ—¶è¿›åº¦æ›´æ–°
- âœ… å“åº”å¼è®¾è®¡
- âœ… çŠ¶æ€æŒ‡ç¤ºå™¨

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- **Python**: 3.11 / 3.12 / 3.13
- **æ“ä½œç³»ç»Ÿ**: Windows / Linux / macOS
- **æµè§ˆå™¨**: ç°ä»£æµè§ˆå™¨ï¼ˆæ”¯æŒ ES6+ å’Œ SSEï¼‰

### å®‰è£…æ­¥éª¤

#### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/yourusername/m3u8-Agent.git
cd m3u8-Agent
```

#### 2. æ£€æŸ¥ Python ç‰ˆæœ¬

```bash
python --version
# æˆ–ä½¿ç”¨æ£€æŸ¥è„šæœ¬
python check_python.py
```

#### 3. å®‰è£…ä¾èµ–

```bash
pip install -r requirements.txt
```

#### 4. é…ç½®æ–‡ä»¶

ç¼–è¾‘ `backend/config.toml`ï¼Œæ ¹æ®éœ€è¦è°ƒæ•´é…ç½®ï¼ˆå¯é€‰ï¼‰ï¼š

```toml
[downloader]
m3u8d_path = "./m3u8d/N_m3u8DL-RE.exe"  # N_m3u8DL-RE è·¯å¾„
save_dir = "./downloads"                # ä¸‹è½½ä¿å­˜ç›®å½•
thread_count = 16                       # ä¸‹è½½çº¿ç¨‹æ•°
```

è¯¦ç»†é…ç½®è¯´æ˜è¯·å‚è€ƒ [CONFIG.md](CONFIG.md)

#### 5. å¯åŠ¨æœåŠ¡

**å¯åŠ¨åç«¯**ï¼ˆå›ºå®š 8000 ç«¯å£ï¼‰ï¼š
```bash
python backend/main.py
```

**å¯åŠ¨å‰ç«¯**ï¼ˆå›ºå®š 8100 ç«¯å£ï¼‰ï¼š
```bash
python frontend/run_frontend.py
```

#### 6. è®¿é—®åº”ç”¨

æ‰“å¼€æµè§ˆå™¨è®¿é—®ï¼š**http://127.0.0.1:8100**

---

## ğŸ“š ä½¿ç”¨è¯´æ˜

### åŸºæœ¬ä½¿ç”¨

1. **åˆ›å»ºä»»åŠ¡**
   - åœ¨"åˆ›å»ºä»»åŠ¡"åŒºåŸŸè¾“å…¥ M3U8 é“¾æ¥
   - è¾“å…¥ä¿å­˜åç§°
   - ç‚¹å‡»"åˆ›å»º"æŒ‰é’®

2. **ç®¡ç†ä»»åŠ¡**
   - ä»»åŠ¡ä¼šè‡ªåŠ¨å¼€å§‹ä¸‹è½½
   - å¯ä»¥æš‚åœ/ç»§ç»­ä»»åŠ¡
   - å¯ä»¥åˆ é™¤ä»»åŠ¡
   - å®æ—¶æŸ¥çœ‹ä¸‹è½½è¿›åº¦

3. **æŸ¥çœ‹æ–‡ä»¶**
   - ä¸‹è½½å®Œæˆçš„æ–‡ä»¶ä¿å­˜åœ¨ `backend/downloads/` ç›®å½•

### å‰ç«¯é…ç½®

å¦‚æœéœ€è¦ä¿®æ”¹åç«¯åœ°å€ï¼Œç¼–è¾‘ `frontend/config.js`ï¼š

```javascript
const API_CONFIG = {
    baseURL: 'http://localhost:8000',  // åç«¯åœ°å€
    timeout: 30000,
    reconnectInterval: 3000
};
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### ä¸»è¦é…ç½®é¡¹

| é…ç½®é¡¹ | é»˜è®¤å€¼ | è¯´æ˜ |
|--------|--------|------|
| `m3u8d_path` | `"./m3u8d/N_m3u8DL-RE.exe"` | N_m3u8DL-RE å¯æ‰§è¡Œæ–‡ä»¶è·¯å¾„ |
| `save_dir` | `"./downloads"` | ä¸‹è½½æ–‡ä»¶ä¿å­˜ç›®å½• |
| `tmp_dir` | `"./downloads_tmp"` | ä¸´æ—¶æ–‡ä»¶ç›®å½• |
| `thread_count` | `16` | ä¸‹è½½çº¿ç¨‹æ•° |
| `download_retry_count` | `3` | ä¸‹è½½é‡è¯•æ¬¡æ•° |
| `max_speed` | `""` | é€Ÿåº¦é™åˆ¶ï¼ˆå¦‚ "10M"ï¼‰ |
| `custom_proxy` | `""` | è‡ªå®šä¹‰ä»£ç† |

å®Œæ•´é…ç½®è¯´æ˜è¯·å‚è€ƒ [CONFIG.md](CONFIG.md)

### å¸¸è§é…ç½®åœºæ™¯

**å¿«é€Ÿä¸‹è½½**ï¼š
```toml
thread_count = 32
max_speed = ""
binary_merge = true
```

**ç¨³å®šä¸‹è½½**ï¼š
```toml
thread_count = 4
max_speed = "5M"
download_retry_count = 5
```

**ä½¿ç”¨ä»£ç†**ï¼š
```toml
use_system_proxy = false
custom_proxy = "http://127.0.0.1:7890"
```

---

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
m3u8-Agent/
â”œâ”€â”€ backend/                    # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ main.py                 # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ config.toml             # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ core/                   # æ ¸å¿ƒé€»è¾‘
â”‚   â”‚   â”œâ”€â”€ config.py           # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ downloader.py       # ä¸‹è½½å™¨å°è£…
â”‚   â”‚   â”œâ”€â”€ task_manager.py     # ä»»åŠ¡ç®¡ç†
â”‚   â”‚   â””â”€â”€ event_bus.py        # äº‹ä»¶æ€»çº¿
â”‚   â”œâ”€â”€ api/                    # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ tasks.py            # ä»»åŠ¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ config.py           # é…ç½®æ¥å£
â”‚   â”‚   â”œâ”€â”€ stream.py           # SSE æ¨é€
â”‚   â”‚   â””â”€â”€ status.py           # çŠ¶æ€æ¥å£
â”‚   â”œâ”€â”€ models/                 # æ•°æ®æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ task.py             # ä»»åŠ¡æ¨¡å‹
â”‚   â”‚   â””â”€â”€ config.py           # é…ç½®æ¨¡å‹
â”‚   â”œâ”€â”€ m3u8d/                  # ä¸‹è½½å·¥å…·
â”‚   â”‚   â””â”€â”€ N_m3u8DL-RE.exe     # N_m3u8DL-RE
â”‚   â”œâ”€â”€ downloads/              # ä¸‹è½½æ–‡ä»¶
â”‚   â””â”€â”€ downloads_tmp/          # ä¸´æ—¶æ–‡ä»¶
â”‚
â”‚   â”œâ”€â”€ var/                    # è¿è¡ŒæœŸæ•°æ®ç›®å½•ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
â”‚   â”‚   â”œâ”€â”€ tasks.json          # ä»»åŠ¡æ•°æ®
â”‚   â”‚   â””â”€â”€ logs/               # ä»»åŠ¡æ—¥å¿—ï¼ˆæ¯ä»»åŠ¡ä¸€ä¸ª .logï¼‰
â”‚
â”œâ”€â”€ frontend/                   # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ index.html              # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ config.js               # å‰ç«¯é…ç½®
â”‚   â”œâ”€â”€ style.css               # æ ·å¼æ–‡ä»¶
â”‚   â”œâ”€â”€ app.js                  # åº”ç”¨é€»è¾‘
â”‚   â””â”€â”€ run_frontend.py         # å‰ç«¯æœåŠ¡å™¨
â”‚
â”œâ”€â”€ requirements.txt            # Python ä¾èµ–
â”œâ”€â”€ README.md                   # ä½¿ç”¨è¯´æ˜ï¼ˆæœ¬æ–‡ä»¶ï¼‰
â”œâ”€â”€ DESIGN.md                   # è®¾è®¡æ–‡æ¡£
â”œâ”€â”€ CONFIG.md                   # é…ç½®è¯´æ˜
â”œâ”€â”€ AGENTS.md                   # AI å¼€å‘è§„èŒƒ
â””â”€â”€ LICENSE                     # è®¸å¯è¯
```

---

## ğŸ“¦ è¿è¡ŒæœŸæ•°æ®ç›®å½•

- å›ºå®šï¼š`backend/var/` ç”¨äºä¿å­˜ä»»åŠ¡æ•°æ®ä¸æ—¥å¿—ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰

## ğŸ”Œ API æ–‡æ¡£

### REST API

| æ–¹æ³• | è·¯å¾„ | æè¿° |
|------|------|------|
| GET | `/api/tasks` | è·å–æ‰€æœ‰ä»»åŠ¡ |
| POST | `/api/tasks` | åˆ›å»ºæ–°ä»»åŠ¡ |
| GET | `/api/tasks/{id}` | è·å–ä»»åŠ¡è¯¦æƒ… |
| DELETE | `/api/tasks/{id}` | åˆ é™¤ä»»åŠ¡ |
| POST | `/api/tasks/{id}/start` | å¼€å§‹ä»»åŠ¡ |
| POST | `/api/tasks/{id}/pause` | æš‚åœä»»åŠ¡ |
| GET | `/api/config` | è·å–é…ç½® |
| PUT | `/api/config` | æ›´æ–°é…ç½® |
| GET | `/api/status` | ç³»ç»ŸçŠ¶æ€ |

### SSE å®æ—¶æ¨é€

```
GET /api/stream/tasks
Content-Type: text/event-stream
```

**äº‹ä»¶ç±»å‹**ï¼š
- `task.created` - ä»»åŠ¡åˆ›å»º
- `task.progress` - è¿›åº¦æ›´æ–°
- `task.completed` - ä»»åŠ¡å®Œæˆ
- `task.failed` - ä»»åŠ¡å¤±è´¥

---

## ğŸš¢ éƒ¨ç½²è¯´æ˜

### æœ¬åœ°å¼€å‘

```bash
# å¯åŠ¨åç«¯ï¼ˆ8000 ç«¯å£ï¼‰
python backend/main.py

# å¯åŠ¨å‰ç«¯ï¼ˆ8100 ç«¯å£ï¼‰
python frontend/run_frontend.py

# è®¿é—®åº”ç”¨
# http://127.0.0.1:8100
```


## ğŸ› ï¸ å¼€å‘æ–‡æ¡£

### æŠ€æœ¯æ ˆ

**åç«¯**ï¼š
- FastAPI - Web æ¡†æ¶
- Uvicorn - ASGI æœåŠ¡å™¨
- Pydantic - æ•°æ®éªŒè¯
- N_m3u8DL-RE - ä¸‹è½½å¼•æ“

**å‰ç«¯**ï¼š
- åŸç”Ÿ HTML/CSS/JavaScript
- Fetch API - HTTP è¯·æ±‚
- EventSource - SSE å®æ—¶æ¨é€

### å¼€å‘è§„èŒƒ

æœ¬é¡¹ç›®é‡‡ç”¨ä¸­æ–‡ç¼–ç¨‹è§„èŒƒï¼Œè¯¦ç»†è¯´æ˜è¯·å‚è€ƒï¼š
- [AGENTS.md](AGENTS.md) - AI å¼€å‘è§„èŒƒ
- [DESIGN.md](DESIGN.md) - è®¾è®¡æ–‡æ¡£

### æµ‹è¯•

```bash
# è¿è¡Œåç«¯æµ‹è¯•
pytest backend/test/

# è¿è¡Œå•ä¸ªæµ‹è¯•
pytest backend/test/test_downloader.py -v
```

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç ã€æŠ¥å‘Šé—®é¢˜æˆ–æå‡ºå»ºè®®ï¼

1. Fork æœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯ Pull Request

---

## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ GPLv3.0 è®¸å¯è¯ - è¯¦è§ [LICENSE](LICENSE) æ–‡ä»¶

---

## ğŸ™ è‡´è°¢

- [N_m3u8DL-RE](https://github.com/nilaoda/N_m3u8DL-RE) - å¼ºå¤§çš„ M3U8 ä¸‹è½½å·¥å…·
- [FastAPI](https://fastapi.tiangolo.com/) - ç°ä»£åŒ–çš„ Python Web æ¡†æ¶

---

## ğŸ“® è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- æäº¤ [Issue](https://github.com/yourusername/m3u8-Agent/issues)
- å‘èµ· [Discussion](https://github.com/yourusername/m3u8-Agent/discussions)

---

<div align="center">
**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª Starï¼â­**
